<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OnTime - Presentation Timer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Include CSS styles -->
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #4CAF50; /* Green */
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }
        .container {
            text-align: center;
            padding: 20px;
            width: 100%;
            box-sizing: border-box;
        }
        #aboutButton {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            cursor: pointer;
        }
        #aboutButton img {
            width: 32px;
            height: 32px;
        }
        #logo {
            max-width: 80%;
            height: auto;
        }
        #timerText {
            font-size: 5em;
            margin-top: 20px;
        }
        #overtimeText {
            font-size: 2em;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        #progressBar {
            width: 80%;
            margin: 20px 0;
            height: 20px;
            appearance: none;
        }
        .inputs {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .inputs label {
            margin-top: 10px;
        }
        .inputs input {
            width: 80%;
            max-width: 300px;
            padding: 10px;
            font-size: 1em;
            margin-top: 5px;
            border: none;
            border-radius: 5px;
            box-sizing: border-box;
            text-align: center;
        }
        .controls {
            margin-top: 20px;
        }
        .controls button {
            background: none;
            border: none;
            cursor: pointer;
            margin: 0 10px;
        }
        .controls button img {
            width: 64px;
            height: 64px;
        }
        @media (orientation: landscape) {
            #timerText {
                font-size: 7.5em;
            }
            #overtimeText {
                font-size: 2.5em;
            }
            .inputs input {
                font-size: 1.2em;
            }
            .controls button img {
                width: 80px;
                height: 80px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Info button -->
        <button id="aboutButton"><img src="ic_info.png" alt="Info"></button>
        <!-- Logo -->
        <img src="ontime.png" alt="OnTime Logo" id="logo">
        <!-- Timer display -->
        <div id="timerText">00:00</div>
        <!-- Overtime display -->
        <div id="overtimeText" style="display:none;">+00:00</div>
        <!-- Progress bar -->
        <progress id="progressBar" value="0" max="100"></progress>
        <!-- Input fields -->
        <div class="inputs">
            <label for="timeInput">Total Time:</label>
            <input type="text" id="timeInput" placeholder="HH:MM:SS or MM:SS or SS">
            <label for="yellowTimeInput">Orange Warning (Time Remaining):</label>
            <input type="text" id="yellowTimeInput" placeholder="HH:MM:SS or MM:SS or SS">
            <label for="redTimeInput">Red Warning (Time Remaining):</label>
            <input type="text" id="redTimeInput" placeholder="HH:MM:SS or MM:SS or SS">
        </div>
        <!-- Control buttons -->
        <div class="controls">
            <button id="playPauseButton"><img src="play.svg" alt="Play"></button>
            <button id="stopButton" disabled><img src="stop.svg" alt="Stop"></button>
        </div>
    </div>
    <!-- Include JavaScript -->
    <script>
        // Get elements from the DOM
        const timeInput = document.getElementById('timeInput');
        const yellowTimeInput = document.getElementById('yellowTimeInput');
        const redTimeInput = document.getElementById('redTimeInput');
        const timerText = document.getElementById('timerText');
        const overtimeText = document.getElementById('overtimeText');
        const playPauseButton = document.getElementById('playPauseButton');
        const stopButton = document.getElementById('stopButton');
        const progressBar = document.getElementById('progressBar');
        const aboutButton = document.getElementById('aboutButton');

        // Timer variables
        let totalTimeInMillis = 0;
        let yellowWarningTimeInMillis = 0;
        let redWarningTimeInMillis = 0;
        let startTimeInMillis = 0;
        let isRunning = false;
        let isPaused = false;
        let pausedTimeOffset = 0;
        let overtimeStartInMillis = 0;
        let pausedOvertimeOffset = 0;
        let timerInterval = null;

        function parseTimeInput(timeStr) {
            try {
                if (!timeStr || timeStr.trim() === '') {
                    return 0;
                }
                let hours = 0, minutes = 0, seconds = 0;
                const parts = timeStr.split(':');
                if (parts.length === 3) {
                    hours = parseInt(parts[0], 10) || 0;
                    minutes = parseInt(parts[1], 10) || 0;
                    seconds = parseInt(parts[2], 10) || 0;
                } else if (parts.length === 2) {
                    minutes = parseInt(parts[0], 10) || 0;
                    seconds = parseInt(parts[1], 10) || 0;
                } else if (parts.length === 1) {
                    seconds = parseInt(parts[0], 10) || 0;
                }
                return ((hours * 3600) + (minutes * 60) + seconds) * 1000;
            } catch (e) {
                return 0;
            }
        }

        function formatTime(millis) {
            let totalSeconds = Math.floor(millis / 1000);
            let hours = Math.floor(totalSeconds / 3600);
            let minutes = Math.floor((totalSeconds % 3600) / 60);
            let seconds = totalSeconds % 60;

            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
            } else if (minutes > 0) {
                return `${minutes}:${seconds.toString().padStart(2,'0')}`;
            } else {
                return `${seconds}`;
            }
        }

        function updateTimerUI(millis) {
            if (millis <= 0) {
                millis = totalTimeInMillis;
            }
            // Update the timer text
            timerText.textContent = formatTime(millis);

            // Update the progress bar
            let progress = ((totalTimeInMillis - millis + 1000) * 100) / totalTimeInMillis;
            progressBar.value = progress;
        }

        function updateOvertimeUI(millis) {
            overtimeText.textContent = '+' + formatTime(millis);
        }

        function parseAndValidateInput() {
            totalTimeInMillis = parseTimeInput(timeInput.value);
            yellowWarningTimeInMillis = parseTimeInput(yellowTimeInput.value);
            redWarningTimeInMillis = parseTimeInput(redTimeInput.value);

            if (totalTimeInMillis <= 0) {
                alert('Total time must be greater than zero.');
                return false;
            }

            if (redWarningTimeInMillis === 0) {
                redWarningTimeInMillis = 1;
            }

            if (redWarningTimeInMillis >= yellowWarningTimeInMillis) {
                alert('Red warning time must be less than orange warning time.');
                return false;
            }

            if (yellowWarningTimeInMillis >= totalTimeInMillis || redWarningTimeInMillis >= totalTimeInMillis) {
                alert('Warning times must be less than the total time.');
                return false;
            }

            return true;
        }

        function handlePlayPause() {
            if (!isRunning) {
                if (!parseAndValidateInput()) return;
                startTimer();
            } else {
                if (isPaused) {
                    resumeTimer();
                } else {
                    pauseTimer();
                }
            }
        }

        function handleStop() {
            stopTimer();
            resetTimerState();
        }

        function startTimer() {
            startTimeInMillis = Date.now() - pausedTimeOffset;
            isRunning = true;
            isPaused = false;
            pausedTimeOffset = 0;
            savePreferences();

            playPauseButton.innerHTML = '<img src="pause.svg" alt="Pause">';
            stopButton.disabled = false;
            timerInterval = setInterval(updateTimer, 1000);
            updateTimer(); // Update immediately
        }

        function pauseTimer() {
            isPaused = true;
            pausedTimeOffset = Date.now() - startTimeInMillis;

            if (overtimeStartInMillis > 0) {
                pausedOvertimeOffset = Date.now() - overtimeStartInMillis;
            }

            playPauseButton.innerHTML = '<img src="play.svg" alt="Play">';
            clearInterval(timerInterval);
            savePreferences();
        }

        function resumeTimer() {
            if (overtimeStartInMillis > 0) {
                overtimeStartInMillis = Date.now() - pausedOvertimeOffset;
                pausedOvertimeOffset = 0;
            }
            startTimer();
        }

        function stopTimer() {
            isRunning = false;
            isPaused = false;
            startTimeInMillis = 0;
            pausedTimeOffset = 0;
            overtimeStartInMillis = 0;

            playPauseButton.innerHTML = '<img src="play.svg" alt="Play">';
            stopButton.disabled = true;
            clearInterval(timerInterval);

            document.body.style.backgroundColor = '#4CAF50'; // Green
            progressBar.value = 0;

            overtimeText.style.display = 'none';

            updateTimerUI(0);

            savePreferences();
        }

        function updateTimer() {
            let elapsedMillis = Date.now() - startTimeInMillis;
            let remainingTime = totalTimeInMillis - elapsedMillis;

            if (remainingTime > 0) {
                updateTimerUI(remainingTime);

                // Handle color changes
                if (remainingTime <= redWarningTimeInMillis) {
                    document.body.style.backgroundColor = 'red';
                } else if (remainingTime <= yellowWarningTimeInMillis) {
                    document.body.style.backgroundColor = 'orange';
                } else {
                    document.body.style.backgroundColor = '#4CAF50'; // Green
                }
            } else {
                // Timer hits zero
                if (overtimeStartInMillis === 0) {
                    document.body.style.backgroundColor = 'red';
                    overtimeStartInMillis = Date.now();

                    overtimeText.style.display = 'block';
                    overtimeText.style.opacity = '1';
                }
                // Update overtime
                let overtimeElapsed = Date.now() - overtimeStartInMillis;
                updateOvertimeUI(overtimeElapsed);
            }
        }

        function setCookie(name, value, days) {
            let expires = '';
            if (days) {
                let d = new Date();
                d.setTime(d.getTime() + (days*24*60*60*1000));
                expires = "; expires=" + d.toUTCString();
            }
            document.cookie = name + "=" + (value || "")  + expires + "; path=/";
        }

        function getCookie(name) {
            let nameEQ = name + "=";
            let ca = document.cookie.split(';');
            for(let i=0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0)==' ') c = c.substring(1,c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
            }
            return null;
        }

        function savePreferences() {
            setCookie('totalTime', timeInput.value, 365);
            setCookie('yellowTime', yellowTimeInput.value, 365);
            setCookie('redTime', redTimeInput.value, 365);
        }

        function loadPreferences() {
            let totalTime = getCookie('totalTime');
            let yellowTime = getCookie('yellowTime');
            let redTime = getCookie('redTime');

            if (totalTime !== null) {
                timeInput.value = totalTime;
            } else {
                timeInput.value = '25:00';
            }
            if (yellowTime !== null) {
                yellowTimeInput.value = yellowTime;
            } else {
                yellowTimeInput.value = '10:00';
            }
            if (redTime !== null) {
                redTimeInput.value = redTime;
            } else {
                redTimeInput.value = '5:00';
            }
        }

        function resetTimerState() {
            startTimeInMillis = 0;
            isRunning = false;
            isPaused = false;
            pausedTimeOffset = 0;
            overtimeStartInMillis = 0;

            totalTimeInMillis = parseTimeInput(timeInput.value);
            updateTimerUI(totalTimeInMillis);

            overtimeText.style.display = 'none';

            document.body.style.backgroundColor = '#4CAF50'; // Green
            progressBar.value = 0;

            playPauseButton.innerHTML = '<img src="play.svg" alt="Play">';
        }

        function setupInputListeners() {
            const inputs = [timeInput, yellowTimeInput, redTimeInput];
            inputs.forEach(input => {
                input.addEventListener('input', () => {
                    savePreferences();
                    totalTimeInMillis = parseTimeInput(timeInput.value);
                    updateTimerUI(totalTimeInMillis);
                });
            });
        }

        playPauseButton.addEventListener('click', handlePlayPause);
        stopButton.addEventListener('click', handleStop);

        aboutButton.addEventListener('click', () => {
            window.location.href = 'about.html';
        });

        window.onload = function() {
            loadPreferences();
            resetTimerState();
            setupInputListeners();
        };
    </script>
</body>
</html>

